# 📝 기능 명세서 (Functional Specification)

| 프로젝트명 | 사초 (Sacho) | 작성일 | 2026-02-03 |
| :--- | :--- | :--- | :--- |
| **작성자** | PM (본인이름) | **버전** | v1.0 (MVP) |
| **대상** | Main Client, Sub Client | **목표** | MVP 빌드 핵심 기능 구현 |

---

## 1. 시스템 아키텍처 & 공통 (System Architecture)

### 1.1. 뷰 & 카메라 (View & Camera)
- **시점:** 2.5D Side-Scrolling (횡스크롤).
- **카메라 로직:**
    - 플레이어 `transform.position`을 Smooth Damping으로 추적.
    - **Dead Zone:** 플레이어가 화면 중앙 일정 범위 내에서 움직일 때는 카메라가 움직이지 않음.
    - **Confiner:** 카메라가 맵(배경) 밖의 빈 공간을 비추지 않도록 `PolygonCollider2D`로 이동 제한.
- **패럴랙스 (Parallax):**
    - 배경 레이어를 3개(원경, 중경, 근경)로 분리.
    - 카메라 이동 속도 대비 `0.5`, `0.8`, `1.0` 비율로 스크롤 속도 차등 적용.

### 1.2. 물리 설정 (Physics)
- **Engine:** Unity Physics 2D.
- **Layer Collision Matrix:**
    - `Player`는 `Enemy`와 충돌하지 않음 (통과 가능).
    - `Player`는 `EnemyAttack`과 충돌함.
    - `Enemy`끼리는 서로 밀어내지 않음 (또는 약하게 밀어냄).

---

## 2. 플레이어 시스템 (Player System)

### 2.1. 상태 머신 (FSM)
플레이어는 아래 상태(State)를 가지며, 조건에 따라 전이됨.
- `Idle`: 대기.
- `Run`: 이동 (속도: 6.0).
- `Jump`: 점프 / `DoubleJump`: 2단 점프.
- `Fall`: 낙하.
- `Dash`: 회피 (0.2초간 무적, 적 통과, 레이어 변경).
- `Attack`: 공격 동작 중 (이동 불가).
- `Hit`: 피격 (0.5초간 경직 및 깜빡임).
- `Die`: 체력 0, 입력 불가.

### 2.2. 조작 (Input)
| 동작 | 키 입력 (Keyboard) | 로직 상세 |
| :--- | :--- | :--- |
| **이동** | Arrow Keys / WASD | 좌우 반전(`flipX`) 처리. |
| **점프** | Space / Z | `AddForce` 방식. 공중에서 1회 추가 입력 가능 (Count 변수 체크). |
| **대시** | Shift / C | 바라보는 방향으로 순간 가속. 쿨타임 1.0초. |
| **공격** | X / J | 현재 장착된 무기의 공격 로직 실행. |
| **교체** | Tab / Q | 무기 슬롯 1 <-> 2 전환. |
| **상호작용** | F | 보상 선택, 포탈 이동 등. |

---

## 3. 전투 시스템 (Combat System)

### 3.1. 히트박스 구조 (Hitbox Logic)
- **HurtBox (피격 박스):** 캐릭터 본체에 붙어있는 Collider (Trigger 아님). 데미지를 받는 영역.
- **AttackBox (공격 박스):** 무기 휘두를 때 생성되었다가 사라지는 Trigger Collider. 데미지를 주는 영역.
- **판정 로직:**
    1. `AttackBox`가 `HurtBox`와 충돌 (`OnTriggerEnter2D`).
    2. 타겟의 태그 확인 (Player <-> Enemy).
    3. 데미지 계산 및 적용 (`TakeDamage()`).
    4. **Hit Stop:** 타격 성공 시 `Time.timeScale`을 0.05초간 0으로 멈췄다 풀어서 타격감 부여.

### 3.2. 무기 명세 (Weapons)
#### A. 환도 (Blade) - 기본 무기
- **타입:** 근접 3연타 콤보.
- **콤보 로직:**
    - 1타(가로 베기) -> 0.3초 내 입력 시 2타 -> 0.3초 내 입력 시 3타.
    - 입력 없으면 콤보 리셋.
- **데미지:** 10 / 10 / 15.

#### B. 조총 (Rifle) - 서브 무기
- **타입:** 원거리 투사체 발사.
- **로직:**
    - 키 입력 시 전방으로 `Projectile` 프리팹 생성 및 발사.
    - **반동:** 발사 시 플레이어가 뒤로 살짝 밀려남 (`AddForce` 반대 방향).
    - **쿨타임:** 0.8초 (연사 불가).
- **데미지:** 8.

---

## 4. 레벨 & 로그라이크 시스템 (Level & Roguelike)

### 4.1. 방 생성 로직 (Room Generation)
- **구조:** 거대한 맵이 아닌 **씬(Scene)** 또는 **프리팹(Prefab)** 단위의 방 교체 방식.
- **진행 플로우:**
    1. 플레이어 방 입장.
    2. 입구/출구 문 **잠금 (Lock)**.
    3. 몬스터 스폰 (Wave 시작).
    4. 몬스터 전멸 (`EnemyCount == 0`).
    5. 출구 문 **잠금 해제 (Unlock)** 및 보상 오브젝트 활성화.
    6. 보상 획득 후 다음 방으로 이동 (Fade Out/In).

### 4.2. 보상 선택 시스템 (Reward Selection)
- **방 클리어 시:** 출구 쪽에 2개의 '홀로그램 표지판' 활성화.
- **옵션 예시:**
    - Type A: [체력 회복] (즉시 HP +20)
    - Type B: [공격력 강화] (이번 런 동안 공격력 +2)
- 플레이어가 다가가서 `F`키를 누르면 해당 보상을 획득하고, 그 보상 타입에 맞는 **다음 씬**을 로드(혹은 랜덤 씬 로드).

---

## 5. 적 AI 시스템 (Enemy AI)

### 5.1. 공통 FSM
- **Detect (감지):** 플레이어가 감지 범위(반경 5m) 내에 들어오면 `Chase`로 전환.
- **Chase (추적):** 플레이어 방향으로 이동. 공격 사거리 내에 들어오면 `Attack`으로 전환.
- **Attack (공격):** 선딜레이(텔레그래프) -> 공격 판정 -> 후딜레이.
- **Hit (피격):** 공격 받으면 잠시 넉백되고 `Chase` 상태로 복귀.

### 5.2. 몬스터 종류 (MVP)
1. **개조된 포졸 (Melee):**
    - 이동 속도 느림. 근접 곤장 공격.
2. **드론 (Ranged):**
    - 공중 유닛. 플레이어 머리 위를 배회하다가 원거리 레이저 발사.

---

## 6. UI 시스템 (User Interface)

- **HUD (항시 표시):**
    - 좌측 상단: 체력바 (HP Bar, Slider UI).
    - 우측 하단: 무기 아이콘 및 남은 탄약/쿨타임.
- **Floating Text:**
    - 데미지 발생 시 캐릭터 머리 위로 숫자가 튀어 오르며 사라짐 (DOTween 활용 권장).
- **Interaction UI:**
    - 상호작용 가능한 오브젝트 근처에 가면 "F 키를 누르시오" 말풍선 표시.

---

## 7. 데이터 저장 (Data Persistence)

- **저장 방식:** `PlayerPrefs` 또는 `JsonUtility`.
- **저장할 데이터:**
    - `SoulData`: 사망해도 유지되는 재화 (사초 데이터).
    - `UnlockStatus`: 해금된 무기 리스트.
- **저장 시점:**
    - 스테이지 클리어 시 (자동 저장).
    - 사망 시 (결과 정산 후 저장).
